BootStrap:docker
From:centos:centos7


%post

#yum check-update
#echo "HI"
#yum -y update
#echo "HI2"
#yum -y upgrade

# Speed up yum
yum install -y yum-plugin-fastestmirror
yum install -y deltarpm

# Omnipath and OpenMPI user libraries for Summit
yum install -y libhfi1 libpsm2 libpsm2-devel libpsm2-compat
yum install -y perftest qperf
yum install -y libibverbs libibverbs-devel rdma
yum install -y numactl-libs numactl-devel



# Other useful libraries
yum install -y pciutils
yum install -y which

# Editors
yum install -y vim emacs

# GCC make bison flex etc
yum groupinstall -y 'Development Tools'
yum install -y wget

# cmake 3.10
cd
wget https://cmake.org/files/v3.10/cmake-3.10.2.tar.gz
tar -xf cmake-3.10.2.tar.gz
cd cmake-3.10.2
./configure --prefix=/usr/local
make -j6
make install


# Stuff for newer gcc
yum install -y libmpc-devel mpfr-devel gmp-devel
yum install -y zlib zlib-devel zlib-static

# gcc 7.3.0
cd
wget https://ftp.gnu.org/gnu/gcc/gcc-7.3.0/gcc-7.3.0.tar.gz
tar -xf gcc-7.3.0.tar.gz
cd gcc-7.3.0
./configure --help
./configure --disable-multilib --with-system-zlib
make -j6
make install


# OpenMPI-2.1.0
wget https://www.open-mpi.org/software/ompi/v2.1/downloads/openmpi-2.1.0.tar.bz2
tar -xf openmpi-2.1.0.tar.bz2
cd openmpi-2.1.0
./configure \
--prefix=/usr/local \
--enable-wrapper-rpath \
--enable-static \
--enable-mpi-thread-multiple \
--with-psm2=/usr \
--enable-oshmem

## OpenMPI options that break things 
#--enable-mpi-ext=all \
#--with-slurm \

make -j6
make install


# Edit command prompt so it's short and shows you in a container
export PS1="Singularity > "

